<!DOCTYPE HTML>
<html>
  <head>
	<title>Master PSM EXEMPLE</title>
    <style>
      html,body {
        margin:0;
        padding: 0px;
        position: absolute;
		background-color: #0f0f0f;
      }
      .canvas{
      	width:150px!important;
      	margin-top: 35px;
      	height : 150px!important;
      	position:relative;
      	display:none;
      	font-family: DS-Digital bold; 

      	font-weight: bold;
      }
      @font-face{
      	font-family: DS-Digital bold;
      	font-weight: bold;
      }
     div { 
	  	font-family: DS-Digital;  
	  	color:white;
	}

    </style>
  </head>
  <body>
  	<div>
		<canvas class="canvas" id="mois-1" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="mois-2" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="jour-1" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="jour-2" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="annee-1" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="annee-2" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
		<canvas class="canvas" id="canvasSelect" style="background-color:white;border:1px solid black; cursor:crosshair; " ></canvas>
	</div>
    <script src="js/three.min.js"></script>
	<script src="js/loaders/ColladaLoader.js"></script>
	<script src="js/controls/OrbitControls.js"></script>
	<script src="js/jquery.js"></script>
    <script>
    var canvas= new Object();
    var textureCanvasVide = "";
    var contenuParEcran = new Object();
		contenuParEcran["mois-1"] = " ";
		contenuParEcran["mois-2"] = " ";
		contenuParEcran["jour-1"] = "  ";
		contenuParEcran["jour-2"] = "  ";
		contenuParEcran["annee-1"] = " ";
		contenuParEcran["annee-2"] = " ";
		contenuParEcran["Select"] = " ";

    var ecranSelectionne = null;

    $(document).ready(function(){
    	canvas['Select'] = document.getElementById('canvasSelect');
    	canvas["mois-1"] = document.getElementById('mois-1');
    	canvas["mois-2"] = document.getElementById('mois-2');
    	canvas["annee-1"] = document.getElementById('annee-1');
    	canvas["annee-2"] = document.getElementById('annee-2');
    	canvas["jour-1"] = document.getElementById('jour-1');
    	canvas["jour-2"] = document.getElementById('jour-2');

    	//on initialise le cancas Select qui est el canvas vide pour l'initialisation des ecrans
    	var ctx = canvas['Select'].getContext('2d'); 
	    ctx.font = "20pt Calibri,Geneva,Arial";
		ctx.fillStyle = "rgb(90,90,180)";
		ctx.fillRect(0,0,300,200);
	    ctx.strokeStyle = "rgb(0,0,0)";
	    ctx.fillStyle = "rgb(200,200,80)";
		ctx.fillText("", 0, 80);
		textureCanvasVide  = new THREE.Texture(canvas[ecranSelectionne]);			
		textureCanvasVide.needsUpdate = true;
		textureCanvasVide.magFilter = THREE.LinearFilter;
		textureCanvasVide.minFilter = THREE.LinearMipMapLinearFilter;
  		
    });
    
	var clickInfo=[];
	document.addEventListener('mousedown',function(evt) {
		clickInfo.userHasClicked = true;
		clickInfo.x = evt.clientX;
		clickInfo.y = evt.clientY;
	}, false);	 
// initialisation du moteur de rendu
		var renderer = new THREE.WebGLRenderer();


// création d'un canvas qui remplit la fenêtre
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		var clock = new THREE.Clock();
		var SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight;
// création d'une caméra perspective(angle d'ouverture, rapport largeur/hauteur, near, far)
		var camera = new THREE.PerspectiveCamera(45, SCREEN_WIDTH / SCREEN_HEIGHT, 100, 2000);
		camera.position.z = 800;
		controls = new THREE.OrbitControls(camera,renderer.domElement);
		
// création de la scène
		var scene = new THREE.Scene();
// variable JavaScript qui me permet d'accéder aux objets	

        var cadran = null;
        var mois = [];
        var jour = [];
        var annee = [];


		var textureCb = new THREE.ImageUtils.loadTexture( 'images/checkerboard.jpg' );
		textureCb.wrapS = textureCb.wrapT = THREE.RepeatWrapping; 
		textureCb.repeat.set( 10, 10 );

		var textureCadran =  new THREE.ImageUtils.loadTexture( 'images/cadran.jpeg' );
	

// modèle COLLADA
		var loader = new THREE.ColladaLoader();
		var dae = null;
		loader.options.convertUpAxis = true;
		loader.load('obj/cadran_test.DAE',function(collada) {
			dae = collada.scene;
			dae.scale.x = dae.scale.y = dae.scale.z = 150.0;
			dae.position.set(0,0,0);
			dae.updateMatrix();
			// Ajoute mon objet à la scène
			scene.add(dae);
			
//on stock les objets dans leur variable respective
			cadran = dae.getObjectByName("Plane002",true);
			mois[0] = dae.getObjectByName("mois-1",true);
			mois[1] = dae.getObjectByName("mois-2",true);
			jour[0] = dae.getObjectByName("jour-1",true);
			jour[1] = dae.getObjectByName("jour-2",true);
			annee[0] = dae.getObjectByName("annee-1",true);
			annee[1] = dae.getObjectByName("annee-2",true);

			mois[0].material.map = textureCb;
			mois[1].material.map = textureCb;
			jour[0].material.map = textureCb;
			jour[1].material.map = textureCb;
			annee[0].material.map = textureCb;
			annee[1].material.map = textureCb;
			cadran.material.map = textureCadran;

			
		});
			
			
		// sources de lumière (une ambiante et 2 ponctuelles)
		var ambientLight = new THREE.AmbientLight(0x2f2f2f);
		scene.add(ambientLight);
		var pointLight1 = new THREE.PointLight(0xffffff,1);
		pointLight1.position.set(-100, 600, 300);
		scene.add(pointLight1);
		var pointLight2 = new THREE.PointLight(0xffffff,1);
		pointLight2.position.set(200, 500, -800);
		scene.add(pointLight2);

		var raycaster = new THREE.Raycaster();
		var projector = new THREE.Projector();
		
// lancement de l'animation
		animate();
		
		var t=0;
		var action=0;


		var action_ = "rien";
		
		

		$(document).keypress(function (e) {
			var charCode = e.keyCode || e.which;
			
			var charStr = String.fromCharCode(charCode);
			if(ecranSelectionne.split("-")[0]=="mois" && contenuParEcran[ecranSelectionne].length<=3)
				contenuParEcran[ecranSelectionne] += charStr;
			if(ecranSelectionne.split("-")[0]=="jour" && contenuParEcran[ecranSelectionne].length<=3)
				contenuParEcran[ecranSelectionne] += charStr;
			if(ecranSelectionne.split("-")[0]=="annee" && contenuParEcran[ecranSelectionne].length<=4)
				contenuParEcran[ecranSelectionne] += charStr;

			updateTexture();
		});
		
		var testPremiereTexture = false;
		function animate(){
			var dt = clock.getDelta();
			t += dt;
				if(!testPremiereTexture){
					console.log("yolo")
					updateTexture();
				} 

			
			// détection du picking
			if (clickInfo.userHasClicked) {
				var directionVector = new THREE.Vector3(( clickInfo.x / SCREEN_WIDTH ) * 2 - 1,
					-( clickInfo.y / SCREEN_HEIGHT ) * 2 + 1,1);

				//console.log(clickInfo.x + ',' + clickInfo.y);
				clickInfo.userHasClicked=false;
				projector.unprojectVector(directionVector, camera);
				directionVector.sub(camera.position);
				directionVector.normalize();
				raycaster.set(camera.position, directionVector);
				
				var intersections = raycaster.intersectObjects(scene.children,true);
							
				if (intersections.length>0) {
					console.log("objectname : "+intersections[0].object.name);
					ecranSelectionne = intersections[0].object.name;					

				}
			}	
				
 // rendu de la scène
			renderer.render(scene, camera);
 
// lancement du frame suivant
			requestAnimationFrame(function(){ animate(); });
			
      }



      
     function updateTexture() {
     	//texturage selon l'ecran cliqué avec son contenu propre
		if ( canvas[ecranSelectionne] != null ){ 
	    	var ctx = canvas[ecranSelectionne].getContext('2d'); 
		    ctx.font = "bold 100pt DS-Digital";
			ctx.fillStyle = "rgb(90,90,90)";
			ctx.fillRect(0,0,300,200);
		    ctx.strokeStyle = "rgb(0,0,0)";
		    ctx.fillStyle = "rgb(200,200,80)";
			ctx.fillText(contenuParEcran[ecranSelectionne], 0, 110);			
			var texture  = new THREE.Texture(canvas[ecranSelectionne]);
			if(canvas[ecranSelectionne]){		 
				texture.needsUpdate = true;
				texture.magFilter = THREE.LinearFilter;
				texture.minFilter = THREE.LinearMipMapLinearFilter;
				dae.getObjectByName(ecranSelectionne,true).material.map = texture;

			}
		}	
		//on rentre dedans seulement une fois
		//INITIALISER LES ECRANS AU DEMARRAGE
		if ( canvas["Select"] != null  && testPremiereTexture!= true && jour[0] != null ){ 
			testPremiereTexture = true;
	    	var ctx = canvas["Select"].getContext('2d'); 
		    ctx.font = "20pt Calibri,Geneva,Arial";
			ctx.fillStyle = "rgb(90,90,90)";
			ctx.fillRect(0,0,300,200);
		    ctx.strokeStyle = "rgb(0,0,0)";
		    ctx.fillStyle = "rgb(200,200,80)";
			ctx.fillText(contenuParEcran["Select"], 0, 110);			
			var texture  = new THREE.Texture(canvas["Select"]);
			if(canvas["Select"]){		 
				texture.needsUpdate = true;
				texture.magFilter = THREE.LinearFilter;
				texture.minFilter = THREE.LinearMipMapLinearFilter;
				jour[0].material.map = texture;
				jour[1].material.map = texture;
				mois[0].material.map = texture;
				mois[1].material.map = texture;
				annee[0].material.map = texture;
				annee[1].material.map = texture;
			}
		}	
	  }

      	


      

    </script>
  </body>
</html>
		